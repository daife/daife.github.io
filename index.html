<!DOCTYPE html>
<html>
<head>
    <title>博客</title>
    <style>
        .my-button {
            padding: 12px 24px;
            background: #2ea44f;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: background 0.3s;
            cursor: pointer;
        }
        .my-button:hover {
            background: #22863a;
        }
        .my-button.loading {
            opacity: 0.7;
            cursor: wait;
        }
    </style>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <h1>欢迎访问我的博客！</h1>
    <a href="#" id="profile-link" class="my-button">点击加载配置</a>

    <script>
        const button = document.getElementById('profile-link');
      
        // 点击事件处理函数
        async function handleButtonClick(event) {
            event.preventDefault(); // 阻止默认跳转行为
            await fetchLatestConfig();
        }

        // 绑定点击事件
        button.addEventListener('click', handleButtonClick);

        // 配置加载逻辑
        async function fetchLatestConfig() {
            if (button.classList.contains('loading')) return;
          
            try {
                // 进入加载状态
                button.textContent = '配置加载中...';
                button.classList.add('loading');

                // 获取最新提交 SHA
                const commitsResponse = await fetch(
                    'https://api.github.com/repos/daife/daife.github.io/commits?path=config.json&per_page=1',
                    { cache: 'no-cache' }
                );
              
                if (!commitsResponse.ok) throw new Error('GitHub API 请求失败');
                const commits = await commitsResponse.json();
                const sha = commits[0].sha;

                // 获取配置文件
                const configResponse = await fetch(
                    `https://raw.githubusercontent.com/daife/daife.github.io/${sha}/config.json?t=${Date.now()}`,
                    { cache: 'no-cache' }
                );
              
                if (!configResponse.ok) throw new Error('配置文件请求失败');
                const config = await configResponse.json();

                // 更新按钮状态
                button.href = config.profile_url;
                button.textContent = '点击跳转';
                button.removeEventListener('click', handleButtonClick); // 移除旧监听器
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = config.profile_url; // 直接跳转
                });
            } catch (error) {
                console.error('加载失败:', error);
                button.textContent = '加载失败，点击重试';
                button.href = '#';
            } finally {
                button.classList.remove('loading');
            }
        }
    </script>
</body>
</html>
